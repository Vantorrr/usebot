<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>USEbot Admin</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .header h1 {
      color: white;
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 8px;
    }
    
    .header p {
      color: rgba(255,255,255,0.9);
      font-size: 1.1rem;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 48px rgba(0,0,0,0.15);
    }
    
    .card h2 {
      color: #2d3748;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card h3 {
      color: #4a5568;
      font-size: 1.1rem;
      font-weight: 600;
      margin: 16px 0 8px 0;
    }
    
    .icon {
      width: 24px;
      height: 24px;
      opacity: 0.8;
    }
    
    input, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      background: #f8fafc;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }
    
    textarea {
      min-height: 120px;
      resize: vertical;
      font-family: inherit;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 12px;
    }
    
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .stat-item {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    
    th {
      background: #f8fafc;
      font-weight: 600;
      color: #4a5568;
    }
    
    .form-row {
      display: flex;
      gap: 12px;
      align-items: end;
      margin-bottom: 16px;
    }
    
    .form-row input {
      margin-top: 0;
    }
    
    .form-row button {
      margin-top: 0;
      white-space: nowrap;
    }
    
    .empty-state {
      text-align: center;
      color: #718096;
      font-style: italic;
      padding: 32px;
    }
    
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .form-row {
        flex-direction: column;
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸ¤– USEbot Admin</h1>
      <p>Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð´Ð°ÑŽÑ‰Ð¸Ð¼ Ð±Ð¾Ñ‚Ð¾Ð¼ Ð¾Ñ‚ Ð´ÐµÐ²ÑƒÑˆÐºÐ¸</p>
    </div>
    <div id="root"></div>
  </div>
  <script>
    const e = React.createElement;

    function useFetch(url, deps) {
      const [data, setData] = React.useState(null);
      React.useEffect(() => {
        fetch(url).then(r => r.json()).then(setData).catch(() => setData(null));
      }, deps);
      return [data, setData];
    }

    function PromptCard() {
      const [data, setData] = useFetch('/api/settings/prompt', []);
      const [value, setValue] = React.useState('');
      React.useEffect(() => { if (data && data.prompt !== undefined) setValue(data.prompt); }, [data]);
      const save = async () => {
        await fetch('/api/settings/prompt', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt: value })});
        alert('âœ… ÐŸÑ€Ð¾Ð¼Ñ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½!');
      };
      return e('div', { className: 'card' }, [
        e('h2', { key: 'h2' }, ['ðŸ§  ÐŸÑ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ LLM']),
        e('textarea', { key: 'ta', value, onChange: e => setValue(e.target.value), placeholder: 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ñ‚ Ð´Ð»Ñ Ð±Ð¾Ñ‚Ð°...' }),
        e('button', { key: 'btn', onClick: save }, 'ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¼Ñ‚')
      ]);
    }

    function Scenarios() {
      const [list, setList] = useFetch('/api/scenarios', []);
      const [name, setName] = React.useState('');
      const create = async () => {
        const r = await fetch('/api/scenarios', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name })});
        if (r.ok) { setName(''); fetch('/api/scenarios').then(r => r.json()).then(setList); }
      };
      return e('div', { className: 'card' }, [
        e('h2', { key: 'h2' }, ['ðŸ“ Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¸ Ð²Ð¾Ñ€Ð¾Ð½ÐºÐ¸']),
        e('div', { key: 'form', className: 'form-row' }, [
          e('input', { placeholder: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ', value: name, onChange: e => setName(e.target.value) }),
          e('button', { onClick: create }, 'âž• Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ')
        ]),
        (list && list.length > 0) ? 
          e('table', { key: 'table' }, [
            e('thead', {}, e('tr', {}, [e('th', {}, 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ'), e('th', {}, 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ')])),
            e('tbody', {}, list.map(s => e('tr', { key: s.id }, [e('td', {}, s.name), e('td', {}, s.is_active ? 'âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½' : 'âŒ ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½')])))
          ]) :
          e('div', { key: 'empty', className: 'empty-state' }, 'ðŸ“‹ ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ²')
      ]);
    }

    function CtaCard() {
      const [data] = useFetch('/api/settings/cta', []);
      const [value, setValue] = React.useState('');
      React.useEffect(() => { if (data && data.cta !== undefined) setValue(data.cta); }, [data]);
      const save = async () => {
        await fetch('/api/settings/cta', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ cta: value })});
        alert('ðŸ”— CTA ÑÑÑ‹Ð»ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð°!');
      };
      return e('div', { className: 'card' }, [
        e('h2', { key: 'h2' }, ['ðŸŽ¯ CTA ÑÑÑ‹Ð»ÐºÐ°']),
        e('input', { key: 'inp', value, onChange: e => setValue(e.target.value), placeholder: 'https://networkassistant.ai/register?invite_code=...' }),
        e('button', { key: 'btn', onClick: save }, 'ðŸ”— Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ')
      ]);
    }

    function Stats() {
      const [stats] = useFetch('/api/stats', []);
      if (!stats) return e('div', { className: 'card' }, [e('h2', {}, 'ðŸ“Š ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°'), e('div', {}, 'â³ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ°...')]);
      
      return e('div', { className: 'card' }, [
        e('h2', { key: 'h2' }, ['ðŸ“Š ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°']),
        e('div', { key: 'stats-grid', className: 'stats-grid' }, [
          e('div', { key: 'dialogs', className: 'stat-item' }, [
            e('div', { className: 'stat-number' }, stats.dialogs || 0),
            e('div', { className: 'stat-label' }, 'Ð”Ð¸Ð°Ð»Ð¾Ð³Ð¾Ð²')
          ]),
          e('div', { key: 'events', className: 'stat-item' }, [
            e('div', { className: 'stat-number' }, stats.events || 0),
            e('div', { className: 'stat-label' }, 'Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ð¹')
          ]),
          e('div', { key: 'conversions', className: 'stat-item' }, [
            e('div', { className: 'stat-number' }, stats.conversions || 0),
            e('div', { className: 'stat-label' }, 'ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¹')
          ])
        ]),
        e('h3', { key: 'h3' }, 'ðŸŽ¯ ÐšÐ¾Ð½Ð²ÐµÑ€ÑÐ¸Ð¸ Ð¿Ð¾ ÑÑ‚Ð°Ð¿Ð°Ð¼'),
        e('div', { key: 'stages' }, (stats.conversionsByStage || []).length > 0 ? 
          (stats.conversionsByStage || []).map(s => `Ð­Ñ‚Ð°Ð¿ ${s.stage}: ${s.count}`).join(' â€¢ ') : 
          'ðŸ“ˆ Ð”Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚'
        ),
        e('h3', { key: 'h4' }, 'ðŸ‘¥ Ð¢Ð¸Ð¿Ñ‹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹'),
        e('div', { key: 'types' }, (stats.userTypes || []).length > 0 ? 
          (stats.userTypes || []).map(t => `${t.user_type}: ${t.count}`).join(' â€¢ ') : 
          'ðŸŽ­ Ð”Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚'
        )
      ]);
    }

    function App() {
      return e('div', { className: 'grid' }, [
        e(PromptCard, { key: 'p' }),
        e(CtaCard, { key: 'c' }),
        e(Scenarios, { key: 's' }),
        e(Stats, { key: 'st' })
      ]);
    }

    ReactDOM.createRoot(document.getElementById('root')).render(e(App));
  </script>
</body>
</html>


